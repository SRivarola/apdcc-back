import{g as z,u as D,j as e,b as P,m as I,a as L,A as O,r as p,l as C,q as G,s as Y,f as X}from"./index-ud7WvSZc.js";import{h as E}from"./moment-WSJ9un1t.js";import{P as Z,m as R}from"./pen-square-MRu9I7uJ.js";import{m as V,t as ee,a as te,b as ae,c as se,d as re,e as ne}from"./chunk-YRZGWF2W-zd0TKMqz.js";import{m as W}from"./chunk-EPDLEVDR-0vwhT5A0.js";import{s as J,l as U}from"./chunk-ZFWMN6TD-xmq3Uv8t.js";import{c as K,g as le}from"./chunk-OFH6WYRQ-VrSlWUnV.js";function oe({round:c}){const{setRefresh:s}=z(),{isOpen:o,onOpen:j,onOpenChange:v}=D(),h=async x=>{const w=localStorage.getItem("apdcc_token");O.promise(async()=>{try{if((await fetch(`https://apdcc-back-production.up.railway.app/api/matches/tournament/${c[0].tournament_id}`,{method:"PUT",credentials:"include",headers:{token:w,body:JSON.stringify({round:c[0].round})}})).ok)return s(),x(),"¡Edición Exitosa! 😄";throw new Error("Oops, algo salió mal 😕")}catch(t){throw new Error(t)}},{loading:"Loading...",success:t=>t,error:t=>t.message})};return e.jsxs(e.Fragment,{children:[e.jsx(P,{isIconOnly:!0,onPress:j,color:"default",size:"sm",className:"bg-default/50 text-default-400 hover:text-white",children:e.jsx(Z,{size:18})}),e.jsx(I,{isOpen:o,size:"lg",onOpenChange:v,backdrop:"blur",className:"border dark text-foreground border-default-400",children:e.jsx(L,{children:x=>e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"flex flex-col gap-1 uppercase",children:"⚠️ Advertencia"}),e.jsxs(W,{className:"max-w-5xl",children:[e.jsx("p",{children:"Esta acción es permanente y no se puede deshacer."}),e.jsx("p",{className:"text-warning",children:"Se cambiaran todas las fechas a partir de la actual, 1 (una) semana hacia adelante."}),e.jsxs("p",{children:["Fecha Actual: ",E(c[0].date).add(1,"days").format("DD-MM-YYYY")]}),e.jsxs("p",{children:["Nueva Fecha: ",E(c[0].date).add(8,"days").format("DD-MM-YYYY")]})]}),e.jsx(R,{children:e.jsx(P,{className:"z-0 order-last w-full font-semibold uppercase bg-primary/60 hover:bg-primary",variant:"solid",radius:"sm",onPress:()=>h(x),children:"Editar"})})]})})})]})}const ie=e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-scoreboard",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e.jsx("path",{d:"M3 5m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z"}),e.jsx("path",{d:"M12 5v2"}),e.jsx("path",{d:"M12 10v1"}),e.jsx("path",{d:"M12 14v1"}),e.jsx("path",{d:"M12 18v1"}),e.jsx("path",{d:"M7 3v2"}),e.jsx("path",{d:"M17 3v2"}),e.jsx("path",{d:"M15 10.5v3a1.5 1.5 0 0 0 3 0v-3a1.5 1.5 0 0 0 -3 0z"}),e.jsx("path",{d:"M6 9h1.5a1.5 1.5 0 0 1 0 3h-.5h.5a1.5 1.5 0 0 1 0 3h-1.5"})]}),Q=e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"flex-shrink-0 pointer-events-none icon icon-tabler icon-tabler-ball-football text-default-400",width:"22",height:"22",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e.jsx("path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0"}),e.jsx("path",{d:"M12 7l4.76 3.45l-1.76 5.55h-6l-1.76 -5.55z"}),e.jsx("path",{d:"M12 7v-4m3 13l2.5 3m-.74 -8.55l3.74 -1.45m-11.44 7.05l-2.56 2.95m.74 -8.55l-3.74 -1.45"})]});function ce({isOpen:c,onOpenChange:s,match:o,tournamentId:j}){const v=localStorage.getItem("apdcc_token"),{setRefresh:h}=z(),[x,w]=p.useState({res_local:0,res_visit:0}),[t,n]=p.useState({red_card:0,yellow_card:0,message:""}),[r,d]=p.useState({red_card:0,yellow_card:0,message:""}),[u,m]=p.useState(null),[g,f]=p.useState([]),[M,T]=p.useState([]),[_,y]=p.useState([]),[k,S]=p.useState([]);p.useEffect(()=>{o&&(async()=>{try{const b=await fetch(`https://apdcc-back-production.up.railway.app/api/targets/tournament/${j}/match/${o._id}`);if(!b.ok){console.log("Algo salio mal en el fetch");return}const{response:l}=await b.json(),N=l.find(a=>a.team_id._id===o.local.team_id._id),$=l.find(a=>a.team_id._id===o.visit.team_id._id);m({local:N._id,visit:$._id})}catch(b){console.error(b)}})()},[j,o._id]),p.useEffect(()=>{const i=async(b,l)=>{try{const N=await fetch(`https://apdcc-back-production.up.railway.app/api/players/all/?team=${b}`,{method:"GET",credentials:"include",headers:{token:v}});if(console.log("response",N),N.ok){const{response:$}=await N.json();l?y($):S($)}}catch(N){throw new Error(N)}};t.red_card>0&&i(o.local.team_id._id,!0),r.red_card>0&&i(o.visit.team_id._id,!1)},[t,r]);const q=i=>{w({...x,[i.target.name]:Number(i.target.value)||0})},A=i=>{i.target.name==="message"?n({...t,message:i.target.value}):n({...t,[i.target.name]:Number(i.target.value)||0})},F=i=>{i.target.name==="message"?d({...r,message:i.target.value}):d({...r,[i.target.name]:Number(i.target.value)||0})},B=(i,b)=>{const l=i.target.value;if(b){if(g.includes(l)){f(l.split(","));return}if(g.length<t.red_card){l==""?f([]):f(l.split(","));return}}else{if(M.includes(l)){T(l.split(","));return}if(M.length<r.red_card){l==""?T([]):T(l.split(","));return}}},H=async i=>{const b=localStorage.getItem("apdcc_token");O.promise(async()=>{try{if((await fetch(`https://apdcc-back-production.up.railway.app/api/matches/results/${o._id}`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",token:b},body:JSON.stringify({results:x,targetLocal:t,targetVisit:r,targetLocal_id:u.local,targetVisit_id:u.visit,redCards:{localPlayersWithRedCards:g,visitPlayersWithRedCards:M}})})).ok)return h(),"Datos cargados con éxito 😀"}catch(l){return console.log(l),"Algo salio mal 😮‍💨"}finally{i()}},{loading:"Loading...",success:l=>l,error:l=>l.message})};return e.jsx(e.Fragment,{children:e.jsx(I,{isOpen:c,onOpenChange:s,size:"3xl",className:"w-full border dark text-foreground border-default-400",children:e.jsx(L,{children:i=>{var b,l,N,$;return e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"flex flex-col gap-1",children:"Carga de datos"}),e.jsx(W,{children:e.jsxs("div",{className:"grid grid-cols-12 gap-10",children:[e.jsxs("div",{className:"block w-full col-span-6",children:[e.jsx("h2",{className:"text-xl uppercase",children:(l=(b=o.local)==null?void 0:b.team_id)==null?void 0:l.name}),e.jsx(C,{size:"sm",variant:"underlined",type:"number",min:"0",step:"1",placeholder:"Goles anotados",startContent:Q,defaultValue:0,name:"res_local",onChange:a=>q(a)}),e.jsx(C,{size:"sm",variant:"underlined",type:"number",min:"0",step:"1",placeholder:"Tarjetas Amarillas",startContent:e.jsx("span",{children:"🟨"}),defaultValue:0,name:"yellow_card",onChange:a=>A(a)}),e.jsx(C,{size:"sm",type:"number",variant:"underlined",min:"0",step:"1",placeholder:"Tarjetas Rojas",startContent:e.jsx("span",{children:"🟥"}),defaultValue:0,name:"red_card",onChange:a=>A(a)}),e.jsx(G,{placeholder:"Mensaje",className:"pt-5 ",name:"message",onChange:a=>A(a)}),t.red_card>0&&_.length?e.jsx(J,{label:"Asignar tarjeta roja",isRequired:!0,className:"col-span-4",variant:"underlined",selectionMode:t.red_card>1?"multiple":"single",isDisabled:t.red_card===g.length,selectedKeys:g,onChange:a=>B(a,!0),children:_.map(a=>e.jsx(U,{value:a._id,children:`${a.first_name+" "+a.last_name}`},`${a._id}`))}):t.red_card>0?e.jsx("div",{className:"flex justify-center w-full mt-3",children:e.jsx(Y,{})}):null]}),e.jsxs("div",{className:"block w-full col-span-6",children:[e.jsx("h2",{className:"text-xl uppercase",children:($=(N=o.visit)==null?void 0:N.team_id)==null?void 0:$.name}),e.jsx(C,{size:"sm",type:"number",variant:"underlined",min:"0",step:"1",placeholder:"Goles anotados",startContent:Q,defaultValue:0,name:"res_visit",onChange:a=>q(a)}),e.jsx(C,{size:"sm",variant:"underlined",type:"number",min:"0",step:"1",placeholder:"Tarjetas Amarillas",startContent:e.jsx("span",{children:"🟨"}),defaultValue:0,name:"yellow_card",onChange:a=>F(a)}),e.jsx(C,{size:"sm",type:"number",variant:"underlined",min:"0",step:"1",placeholder:"Tarjetas Rojas",startContent:e.jsx("span",{children:"🟥"}),defaultValue:0,name:"red_card",onChange:a=>F(a)}),e.jsx(G,{placeholder:"Mensaje",className:"pt-5 ",name:"message",onChange:a=>F(a)}),r.red_card>0&&k.length?e.jsx(J,{label:"Asignar tarjeta roja",isRequired:!0,className:"col-span-4",variant:"underlined",selectedKeys:M,isDisabled:r.red_card===M.length,selectionMode:r.red_card>1?"multiple":"single",onChange:a=>B(a,!1),children:k.map(a=>e.jsx(U,{value:a._id,children:`${a.first_name+" "+a.last_name}`},`${a._id}`))}):r.red_card>0?e.jsx("div",{className:"flex justify-center w-full mt-3",children:e.jsx(Y,{})}):null]})]})}),e.jsx(R,{children:e.jsx(P,{className:"z-0 order-last w-full font-semibold uppercase bg-primary/60 hover:bg-primary",variant:"solid",radius:"sm",startContent:ie,onPress:()=>{H(i)},children:"Guardar"})})]})}})})})}function de({match:c}){const{setRefresh:s}=z(),{isOpen:o,onOpen:j,onOpenChange:v}=D(),[h,x]=p.useState({date:"",time:""}),w=n=>{const{name:r,value:d}=n.target;if(r==="date"){const u=new Date(n.target.value),m=E(u).format("MM-DD-YYYY");x({...h,date:m})}if(r==="time"){const u=n.target.value+"hs";x({...h,time:u})}x({...h,[r]:d})};async function t(n){const r=localStorage.getItem("apdcc_token");O.promise(async()=>{try{if((await fetch(`https://apdcc-back-production.up.railway.app/api/matches/match/${c._id}`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",token:r},body:JSON.stringify(h)})).ok)return s(),n(),"Datos modificados con éxito 😀"}catch(d){console.log(d)}},{loading:"Loading...",success:d=>d,error:d=>d.message})}return e.jsxs(e.Fragment,{children:[e.jsx(P,{isIconOnly:!0,color:"default",onPress:j,size:"sm",className:"w-fit bg-default/50 text-default-400 hover:text-white my-auto",children:e.jsx(Z,{size:18})}),e.jsx(I,{isOpen:o,size:"2xl",onOpenChange:v,backdrop:"blur",className:"border dark text-foreground border-default-400",children:e.jsx(L,{children:n=>e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"flex flex-col gap-1 uppercase",children:"⚠️ Advertencia"}),e.jsxs(W,{className:"max-w-5xl",children:[e.jsx("p",{children:"Esta acción es permanente y no se puede deshacer."}),e.jsxs("p",{children:["Fecha Actual: ",E(c.date).add(1,"days").format("DD-MM-YYYY")]}),e.jsxs("p",{children:["Horario Actual: ",c.time]}),e.jsx(C,{id:"date",type:"date",name:"date",value:h.data,onChange:w}),e.jsx(C,{id:"time",type:"time",name:"time",value:h.time,onChange:w})]}),e.jsx(R,{children:e.jsx(P,{className:"z-0 order-last w-full font-semibold uppercase bg-primary/60 hover:bg-primary",variant:"solid",radius:"sm",onPress:()=>t(n),children:"Editar"})})]})})})]})}const ue=function({match:s,tournamentId:o,i:j}){var n,r,d,u,m,g,f,M;const h=X().pathname,{isOpen:x,onOpen:w,onOpenChange:t}=D();return e.jsxs("div",{className:`flex ${j%2===0?"flex-row":"flex-row-reverse"} gap-2 items-stretch`,children:[h.startsWith("/dashboard")?e.jsx(de,{match:s}):null,e.jsxs("div",{className:`${(n=s==null?void 0:s.res_local)!=null&&n.toString()&&((r=s==null?void 0:s.res_visit)!=null&&r.toString())?"pointer-events-none border-success/40":""} grid items-center grid-cols-3 col-span-2 gap-2 lg:gap-5 px-5 py-3 m-3 text-center transition-transform duration-150 ease-linear border rounded-lg  md:col-span-1 border-default-200 bg-gradient-to-br from-white to-default-200 dark:from-default-50 dark:to-black ${h.startsWith("/dashboard")&&"hover:scale-105 cursor-pointer"} relative w-full`,onClick:w,children:[e.jsx("p",{className:"col-start-1 text-sm text-default-400",children:"Local"}),e.jsx("p",{className:"col-start-2 mb-auto text-sm lg:text-base",children:E(s.date).add(1,"days").format("DD-MM-YYYY")}),e.jsxs("div",{className:"flex flex-col items-center col-start-1 row-start-2 min-h-24",children:[e.jsx("p",{className:"text-xs font-semibold uppercase lg:text-sm lg:font-bold",children:((u=(d=s.local)==null?void 0:d.team_id)==null?void 0:u.name)||e.jsx(K,{variant:"flat",color:"warning",children:"fecha libre"})}),(m=s==null?void 0:s.res_local)!=null&&m.toString()?e.jsx("span",{className:"text-xl font-bold lg:text-2xl",children:s.res_local}):null]}),e.jsx("div",{className:"flex flex-col items-center justify-between col-start-2 row-start-2 gap-3 my-auto",children:e.jsx("span",{className:" text-warning",children:"vs"})}),e.jsx("p",{className:"col-start-3 text-sm text-default-400",children:"Visitante"}),e.jsxs("div",{className:"relative flex flex-col items-center col-start-3 row-start-2",children:[e.jsx("p",{className:"text-xs font-bold uppercase lg:text-sm",children:((f=(g=s.visit)==null?void 0:g.team_id)==null?void 0:f.name)||e.jsx(K,{variant:"flat",color:"warning",children:"fecha libre"})}),(M=s==null?void 0:s.res_visit)!=null&&M.toString()?e.jsx("span",{className:"text-xl font-bold lg:text-2xl",children:s.res_visit}):null]})]}),h.startsWith("/dashboard")&&e.jsx(ce,{isOpen:x,onOpenChange:t,match:s,tournamentId:o})]})},me=ue;function pe({round:c,tournamentId:s}){return e.jsx(e.Fragment,{children:c.map((o,j)=>e.jsx(me,{match:o,tournamentId:s,i:j},j))})}const he=function({matches:s,tournamentId:o}){const v=X().pathname,{refresh:h}=z(),[x,w]=p.useState([]);return p.useEffect(()=>{const t=Object.values(s.reduce((n,r)=>{const d=r.round;return n[d]||(n[d]=[]),n[d].push(r),n},{}));w(t)},[s,h]),e.jsx("div",{className:"mb-10",children:x.map((t,n)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-10 text-lg font-bold text-center",children:[e.jsxs("h1",{children:["Fecha ",n+1]}),v.startsWith("/dashboard")?e.jsx(oe,{round:t}):null]}),e.jsx("span",{className:"relative grid grid-cols-1 lg:grid-cols-2 lg:gap-16 mx-auto mt-5 lg:mt-10 max-w-7xl",children:e.jsx(pe,{round:t,tournamentId:o})})]},`${t._id}${n+1}match`))})},xe=he,ge=xe;function ke({id:c,isClient:s}){const o=[{label:"Equipo",key:"team_id"},{label:"PJ",key:"played_matches"},{label:"PG",key:"wins"},{label:"PP",key:"losses"},{label:"PE",key:"ties"},{label:"🟨",key:"yellow_card"},{label:"🟥",key:"red_card"},{label:"Pts",key:"points"}],{refresh:j}=z(),[v,h]=p.useState(!0),[x,w]=p.useState([]),[t,n]=p.useState(),[r,d]=p.useState([]);return p.useEffect(()=>{const u=localStorage.getItem("apdcc_token");(async()=>{try{const g=await fetch(`https://apdcc-back-production.up.railway.app/api/tournaments/tournament/${c}`,{headers:{token:u}});if(!g.ok){console.log("Algo salio mal en el fetch");return}const{response:f}=await g.json();n({category:f.category_id.name,day:f.day,name:f.name,sport:f.sport,time:f.time,teams_quantity:f.teams_quantity,createdAt:f.createdAt,updatedAt:f.updatedAt})}catch(g){throw new Error(g)}})()},[c,j]),p.useEffect(()=>{(async()=>{try{const m=await fetch(`https://apdcc-back-production.up.railway.app/api/matches/?tournament_id=${c}`);if(!m.ok){console.log("Algo salio mal en el fetch");return}const{response:g}=await m.json();d(g)}catch(m){console.log(m)}})()},[c,j]),p.useEffect(()=>{(async()=>{try{const m=await fetch(`https://apdcc-back-production.up.railway.app/api/targets/tournament/${c}`);if(!m.ok){console.log("Algo salio mal en el fetch");return}const{response:g}=await m.json(),T=Object.values(g.reduce((_,y)=>{const k=y.team_id._id;return _[k]||(_[k]=[]),_[k].push(y),_},{})).map(_=>_.reduce((y,k)=>(Object.keys(k).forEach(S=>{typeof k[S]=="number"&&(y[S]=(y[S]||0)+k[S])}),y.team_id=k.team_id,y),{})).sort((_,y)=>y.points!==_.points?y.points-_.points:_.red_card!==y.red_card?_.red_card-y.red_card:_.yellow_card-y.yellow_card);w(T)}catch(m){console.error(m)}finally{h(!1)}})()},[]),e.jsxs("div",{children:[t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"lg:px-3 mb-6 text-center",children:[e.jsx("h1",{className:"text-xl lg:text-3xl font-bold uppercase",children:t==null?void 0:t.name}),e.jsx("span",{className:"font-semibold uppercase text-default-400",children:`${t==null?void 0:t.sport} (${t==null?void 0:t.category}) / ${t.day} ${t==null?void 0:t.time}`})]}),e.jsx("div",{className:"flex items-center justify-between px-3",children:e.jsxs("p",{className:"mb-2 text-default-400 text-small",children:["Total ",t==null?void 0:t.teams_quantity," equipos"]})})]}):null,e.jsxs(ee,{"aria-label":"Users Table",children:[e.jsx(te,{columns:o,children:u=>e.jsx(ae,{className:"uppercase",children:u.label},u.key)}),e.jsx(se,{emptyContent:v?" ":x.length===0?"No se encontraron torneos":"",items:v?[]:x,isLoading:v,loadingContent:e.jsx(Y,{label:"Loading..."}),children:u=>e.jsx(re,{className:"justify-center",children:m=>e.jsx(ne,{children:m==="team_id"?e.jsx("p",{children:u.team_id.name}):le(u,m)})},u.team_id._id)})]}),s?null:e.jsx(ge,{matches:r,tournamentId:c})]})}export{ke as C,ge as F};
