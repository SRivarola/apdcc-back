import{r as t,j as s,ae as de,T as oe,i as D,s as ee,N as se,b as le,A as V,a as ce,m as ue,d as fe,_ as _e,af as xe}from"./index-3KicDlp5.js";import{S as W,F as O}from"./SectionContainer-MrEbwLjY.js";import{b as pe,s as me}from"./ballIcon-8FWRYDhW.js";import{s as z,l as J}from"./chunk-ZFWMN6TD-uk_7L4aq.js";import{t as je}from"./chunk-K3TANQWH-59KShvQ7.js";import{c as G}from"./chunk-AMSULWPV-L3xJPEQm.js";import{P as ye}from"./pen-square-wJYY6KCC.js";import{m as be}from"./chunk-3S23ARPO-nuc0lEwC.js";import{m as Pe}from"./chunk-EPDLEVDR-ozBfxMIy.js";import"./chunk-YRZGWF2W-pzygicUT.js";import"./chunk-7F3ZLNJ6-TtujvjjJ.js";function ve({match:l}){const[e,n]=t.useState([]),[a,o]=t.useState(!0);return t.useEffect(()=>{l&&(async(c,u)=>{const y=await de(c,u);if(y.ok){const{response:x}=await y.json();n([...x[0].red_cards,...x[1].red_cards])}o(!1)})(l.tournament_id._id,l._id)},[l]),s.jsxs("div",{className:"flex justify-center gap-10 p-5 px-20 mx-auto mt-16",children:[s.jsx(W,{title:"JUEGO LIMPIO",isFetching:a,targets:!0,children:s.jsx(O,{items:[l.fair_play],tournament:!1})}),s.jsx(W,{title:"MEJOR JUGADOR",isFetching:a,targets:!0,children:s.jsx(O,{items:[l.best_player],tournament:!1})}),s.jsx(W,{title:"tarjetas rojas 🟥",isFetching:a,targets:!0,children:s.jsx(O,{items:e,tournament:!1})})]})}function we({infoHeader:l,match:e}){return s.jsxs("div",{className:"mb-6 text-center lg:px-3",children:[s.jsx("h1",{className:"text-xl font-bold uppercase lg:text-3xl",children:l==null?void 0:l.name}),s.jsx("span",{className:"font-semibold uppercase text-default-400",children:`${oe(e.date).add(1,"days").format("DD-MM-YYYY")} - ${l==null?void 0:l.time}`})]})}const Ne=function({match:e,targetLocal:n,targetVisit:a}){var o,d;return s.jsxs("div",{className:"flex items-start justify-between max-w-6xl gap-5 pt-5 mx-auto lg:mt-10",children:[s.jsxs("div",{className:"flex flex-col items-center justify-end w-full",children:[s.jsx("p",{className:"text-default-400",children:"Local"}),s.jsx("h2",{className:"text-lg font-bold uppercase lg:text-2xl",children:(o=e==null?void 0:e.local)==null?void 0:o.team_id.name}),s.jsx("p",{className:`${(e==null?void 0:e.res_local)>(e==null?void 0:e.res_visit)?"text-success shadow-green-600 rounded-md shadow":"rounded-md shadow shadow-white"} p-5 m-5  text-7xl text-extrabold`,children:e==null?void 0:e.res_local}),s.jsx("p",{className:`${n!=null&&n.message?"":"text-default-400"} p-5`,children:(n==null?void 0:n.message)||"No hay mensaje"})]}),s.jsxs("div",{className:"flex flex-col items-center justify-end w-full",children:[s.jsx("p",{className:"text-default-400",children:"Visitante"}),s.jsx("h2",{className:"text-lg font-bold uppercase lg:text-2xl",children:(d=e==null?void 0:e.visit)==null?void 0:d.team_id.name}),s.jsx("p",{className:`${(e==null?void 0:e.res_visit)>(e==null?void 0:e.res_local)?"text-success shadow-green-600 rounded-md shadow":"rounded-md shadow shadow-white"} p-5 m-5  text-7xl text-extrabold`,children:e==null?void 0:e.res_visit}),s.jsx("p",{className:`${a!=null&&a.message?"":"text-default-400"} p-5`,children:(a==null?void 0:a.message)||"No hay mensaje"})]})]})},he=Ne,ge=he,L=({isLocal:l,match:e,handleResults:n,handleTarget:a,target:o,defaultRedCards:d,valueTarget:c,players:u,handleSelectionChange:y,playersWithRedCards:x,bestAndFairPlayerExist:h,bestPlayer:v,setBestPlayer:m,otherBestPlayer:p,best_player:b,handleBestPlayer:R,fairPlay:g,setFairPlay:M,otherFairPlay:w,fair_play:F,handleFairPlayer:N})=>{var S,C,$,P;return s.jsxs("div",{className:"block w-full col-span-6",children:[s.jsx("h2",{className:"text-xl uppercase",children:l?(C=(S=e.local)==null?void 0:S.team_id)==null?void 0:C.name:(P=($=e.visit)==null?void 0:$.team_id)==null?void 0:P.name}),s.jsx(D,{size:"sm",variant:"underlined",type:"number",min:"0",step:"1",placeholder:"Goles anotados",startContent:pe,defaultValue:l?e.res_local:e.res_visit,name:l?"res_local":"res_visit",onChange:r=>n(r)}),s.jsx(D,{size:"sm",variant:"underlined",type:"number",min:"0",step:"1",placeholder:"Tarjetas Amarillas",startContent:s.jsx("span",{children:"🟨"}),defaultValue:o==null?void 0:o.yellow_card,name:"yellow_card",onChange:r=>a(r)}),s.jsx(D,{size:"sm",type:"number",variant:"underlined",min:"0",step:"1",placeholder:"Tarjetas Rojas",startContent:s.jsx("span",{children:"🟥"}),defaultValue:(d==null?void 0:d.length)||0,name:"red_card",onChange:r=>a(r)}),s.jsx("div",{className:"h-16",children:(c==null?void 0:c.red_card)>0&&(u!=null&&u.length)?s.jsx(z,{label:"Asignar tarjeta roja",isRequired:!0,className:"col-span-4",variant:"underlined",selectionMode:c.red_card>1?"multiple":"single",selectedKeys:x??d,onChange:r=>y(r,l),children:u.map(r=>s.jsx(J,{value:r._id,children:`${r.first_name+" "+r.last_name}`},`${r._id}`))}):(c==null?void 0:c.red_card)>0?s.jsx("div",{className:"flex justify-center w-full mt-3",children:s.jsx(ee,{})}):null}),s.jsx(je,{placeholder:"Mensaje",className:"pt-5 ",name:"message",defaultValue:o.message,onChange:r=>a(r)}),h?s.jsxs(s.Fragment,{children:[s.jsx(G,{isSelected:v,onValueChange:m,className:"mt-3",isDisabled:p,children:"Mejor Jugador"}),v&&s.jsx(z,{"aria-label":"Best Local Player",placeholder:"Selecciona al mejor jugador",variant:"underlined",name:"best_player",value:b,onChange:R,children:u.map(r=>s.jsx(J,{value:r._id,children:`${r.first_name+" "+r.last_name}`},`${r._id}`))}),s.jsxs("div",{children:[s.jsx(G,{isSelected:g,onValueChange:M,className:"mt-3",isDisabled:w,children:"Juego Limpio"}),g&&s.jsx(z,{"aria-label":"Fair Local Player",placeholder:"Selecciona juego limpio",variant:"underlined",name:"fair_play",value:F,defaultValue:(e==null?void 0:e.fair_play)||void 0,onChange:N,children:u.map(r=>s.jsx(J,{value:r._id,children:`${r.first_name+" "+r.last_name}`},r._id))})]})]}):null]})},Se=function({bestPlayer:e,fairPlay:n,bestAndFairPlayerExist:a,setbestAndFairPlayerExist:o}){return s.jsxs("div",{className:"flex flex-col items-center text-center px-6 py-3 w-full dark bg-[#18181b] text-foreground",children:[s.jsxs("h2",{className:"text-center",children:["Datos actuales de ",s.jsx("b",{className:"uppercase",children:"mejor jugador"})," y"," ",s.jsx("b",{className:"uppercase",children:"fair play"})]}),s.jsxs("p",{className:"pt-3 text-sm text-center uppercase ",children:["Mejor jugador: ",s.jsx("span",{className:"text-lg",children:e})]}),s.jsxs("p",{className:"pt-1 text-sm text-center uppercase",children:["Juego Limpio: ",s.jsx("span",{className:"text-lg",children:n})]}),s.jsx(G,{isSelected:a,onValueChange:o,className:"mt-3",color:"warning",children:"⚠️ Desea modificar los datos?"})]})},Ce=Se,$e=({onClose:l,match:e,targetL:n,targetV:a,targetLocal:o,setTargetLocal:d,targetVisit:c,setTargetVisit:u,defaultRedCardLocal:y,defaultRedCardVisit:x,localPlayers:h,visitPlayers:v,targets:m,bestAndFairPlayerExist:p,setbestAndFairPlayerExist:b})=>{var Q,X,Z,H;const{setRefresh:R}=se(),[g,M]=t.useState({res_local:e==null?void 0:e.res_local,res_visit:e==null?void 0:e.res_visit}),[w,F]=t.useState(),[N,S]=t.useState(),[C,$]=t.useState(!1),[P,r]=t.useState(!1),[_,B]=t.useState(e==null?void 0:e.best_player._id),[k,E]=t.useState(!1),[T,ae]=t.useState(!1),[I,re]=t.useState(e==null?void 0:e.fair_play._id),Y=j=>{const{name:f,value:i}=j.target;M(i===""?A=>({...A,[f]:f==="res_local"?e.res_local:e.res_visit}):A=>({...A,[f]:Number(i)}))},ne=j=>{const{name:f,value:i}=j.target;if(f==="yellow_card"&&i===""&&d({...o,yellow_card:Number(n.yellow_card)}),f==="red_card"){if(i==="")return d({...o,red_card:n.red_cards.length});i==0&&F([])}if(f==="message"){if(i===""){d({...o,message:n.message});return}d({...o,message:i})}else d({...o,[f]:Number(i)})},ie=j=>{const{name:f,value:i}=j.target;if(f==="yellow_card"&&i===""){u({...c,yellow_card:Number(a.yellow_card)});return}if(f==="red_card"){if(i==="")return u({...c,red_card:a.red_cards.length});i==0&&S([])}if(f==="message"){if(i===""){u({...c,message:a.message});return}u({...c,message:i})}else u({...c,[f]:Number(i)})},U=(j,f)=>{const i=j.target.value;if(f){F(i.split(","));return}else{S(i.split(","));return}},q=j=>{const{value:f}=j.target;B(f)},K=j=>{const{name:f,value:i}=j.target;re(i)},te=async j=>{const f={res_local:g.res_local??e.res_local,res_visit:g.res_visit??e.res_visit,targetLocal:o,targetVisit:c,best_player:_,fair_play:I,targetLocal_id:m.local,targetVisit_id:m.visit,redCards:{localPlayersWithRedCards:w??n.red_cards.map(i=>i._id),visitPlayersWithRedCards:N??a.red_cards.map(i=>i._id)}};if(w&&w.length!==o.red_card||N&&N.length!==c.red_card){V.error("El número de 🟥 no coincide con la cantidad de jugadores");return}V.promise(async()=>{try{if((await fetch(`149.50.137.116:8080/api/matches/results/${e._id}`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)})).ok)return R(),"Datos cargados con éxito 😀"}catch(i){return console.log(i),"Algo salio mal 😮‍💨"}finally{j()}},{loading:"Loading...",success:i=>i,error:i=>i.message})};return s.jsxs("form",{className:"flex flex-col gap-10",children:[s.jsxs("div",{className:"flex gap-10",children:[s.jsx(L,{isLocal:!0,match:e,handleResults:Y,handleTarget:ne,target:n,defaultRedCards:y,valueTarget:o,players:h,handleSelectionChange:U,playersWithRedCards:w,bestAndFairPlayerExist:p,bestPlayer:C,setBestPlayer:$,otherBestPlayer:P,best_player:_,handleBestPlayer:q,fairPlay:k,setFairPlay:E,otherFairPlay:T,fair_play:I,handleFairPlayer:K}),s.jsx(L,{isLocal:!1,match:e,handleResults:Y,handleTarget:ie,target:a,defaultRedCards:x,valueTarget:c,players:v,handleSelectionChange:U,playersWithRedCards:N,bestAndFairPlayerExist:p,bestPlayer:P,setBestPlayer:r,otherBestPlayer:C,best_player:_,handleBestPlayer:q,fairPlay:T,setFairPlay:ae,otherFairPlay:k,fair_play:I,handleFairPlayer:K})]}),p?null:s.jsx(Ce,{bestPlayer:`${(Q=e==null?void 0:e.best_player)==null?void 0:Q.last_name} ${(X=e==null?void 0:e.best_player)==null?void 0:X.first_name}`,fairPlay:`${(Z=e==null?void 0:e.fair_play)==null?void 0:Z.last_name} ${(H=e==null?void 0:e.fair_play)==null?void 0:H.first_name}`,bestAndFairPlayerExist:p,setbestAndFairPlayerExist:b}),s.jsx(le,{className:"z-0 order-last w-full font-semibold uppercase bg-primary/60 hover:bg-primary",variant:"solid",radius:"sm",startContent:me,onPress:()=>{te(l)},children:"Guardar"})]})},Me=$e;function Fe({match:l,tournamentId:e,targetL:n,targetV:a}){const{isOpen:o,onOpen:d,onOpenChange:c}=ce(),[u,y]=t.useState(!0),[x,h]=t.useState({red_card:n==null?void 0:n.red_cards.length,yellow_card:n==null?void 0:n.yellow_card,message:n==null?void 0:n.message}),[v,m]=t.useState({red_card:a==null?void 0:a.red_cards.length,yellow_card:a==null?void 0:a.yellow_card,message:a==null?void 0:a.message}),[p,b]=t.useState(null),[R,g]=t.useState(),[M,w]=t.useState(),[F,N]=t.useState([]),[S,C]=t.useState([]);t.useEffect(()=>{y(!0),l!=null&&l.best_player._id&&(l!=null&&l.fair_play._id)&&y(!1)},[l,c]),t.useEffect(()=>{l&&(async()=>{try{const r=await fetch(`149.50.137.116:8080/api/targets/tournament/${e}/match/${l._id}`);if(!r.ok){console.log("Algo salio mal en el fetch");return}const{response:_}=await r.json(),B=_.find(E=>E.team_id._id===l.local.team_id._id),k=_.find(E=>E.team_id._id===l.visit.team_id._id);b({local:B._id,visit:k._id})}catch(r){console.error(r)}})()},[e,l._id]);const $=async(P,r)=>{try{const _=await fetch(`149.50.137.116:8080/api/players/all/?team=${P}`,{method:"GET",credentials:"include"});if(_.ok){const{response:B}=await _.json();r?N(B):C(B)}}catch(_){throw new Error(_)}};return t.useEffect(()=>{$(l.local.team_id._id,!0)},[x]),t.useEffect(()=>{$(l.visit.team_id._id,!1)},[v]),t.useEffect(()=>{const P=n.red_cards.map(_=>_._id);g(P);const r=a.red_cards.map(_=>_._id);w(r)},[]),s.jsxs(s.Fragment,{children:[s.jsx(le,{onPress:d,color:"primary",size:"sm",endContent:s.jsx(ye,{size:16}),className:"top-0 right-0 flex font-semibold hover:text-white ms-auto",children:"Editar"}),s.jsx(ue,{isOpen:o,onOpenChange:c,size:"4xl",className:"w-full border dark text-foreground border-default-400",children:s.jsx(fe,{children:P=>s.jsxs(s.Fragment,{children:[s.jsx(be,{className:"flex flex-col gap-1",children:"Carga de datos"}),s.jsx(Pe,{children:s.jsx(Me,{onClose:P,match:l,targetL:n,targetV:a,targetLocal:x,setTargetLocal:h,targetVisit:v,setTargetVisit:m,defaultRedCardLocal:R,defaultRedCardVisit:M,localPlayers:F,visitPlayers:S,targets:p,bestAndFairPlayerExist:u,setbestAndFairPlayerExist:y})})]})})})]})}function Ge(){const{id:l}=_e(),{isHiddenTopBar:e,refresh:n}=se(),[a,o]=t.useState(),[d,c]=t.useState(null),[u,y]=t.useState(),[x,h]=t.useState();return t.useEffect(()=>{l&&(async m=>{const p=await xe(m);if(p.ok){const{response:b}=await p.json();c(b),o(b.tournament_id)}})(l)},[l,n]),t.useEffect(()=>{async function v(){try{const m=await fetch(`149.50.137.116:8080/api/targets/tournament/${d.tournament_id._id}/match/${d._id}`);if(m.ok){const{response:p}=await m.json();y(p.filter(b=>b.team_id._id===d.local.team_id._id)[0]),h(p.filter(b=>b.team_id._id===d.visit.team_id._id)[0])}}catch(m){console.log(m)}}d&&v()},[d]),d?s.jsxs("section",{className:`${e?"pt-12":"pt-36"} absolute top-0 left-0 w-full pl-5 lg:pl-[200px] pb-16  lg:pt-20 pr-5 overflow-y-scroll h-screen bg-black`,children:[u&&x?s.jsx(Fe,{match:d,tournamentId:d.tournament_id._id,targetL:u,targetV:x}):null,s.jsx(we,{infoHeader:a,match:d}),s.jsx(ge,{match:d,targetLocal:u,targetVisit:x}),s.jsx(ve,{match:d,targetLocal:u,targetVisit:x})]}):s.jsx("div",{className:`${e?"pt-12":"pt-36"} absolute top-0 left-0 flex justify-center items-center w-full pl-5 lg:pl-[200px] pb-16  lg:pt-20 pr-5 overflow-y-scroll h-screen bg-black`,children:s.jsx(ee,{})})}export{Ge as default};
