import{r as n,j as e,a8 as ie,l as oe,s as V,h as L,b as ee,A as X,t as se,a as de,m as ce,c as ue,q as fe,a9 as _e}from"./index-zsI5OImO.js";import{S as D,F as O}from"./SectionContainer-uib7lxBC.js";import{b as pe,s as xe}from"./ballIcon-InYoBcFl.js";import{i as W}from"./chunk-TC4QW7OA-smmxgv9d.js";import{s as z,l as J}from"./chunk-ZFWMN6TD-Ok3w5I4N.js";import{t as me}from"./chunk-K3TANQWH-vv8GNUEZ.js";import{c as Z}from"./chunk-AMSULWPV-aaCFLJbH.js";import{P as ye}from"./pen-square-Y3WBrMv5.js";import{m as je}from"./chunk-3S23ARPO-FeJC1ANL.js";import{m as he}from"./chunk-EPDLEVDR-4luy-7lX.js";import"./chunk-YRZGWF2W-Utd-n8kC.js";import"./chunk-7F3ZLNJ6-ei5zIsh2.js";import"./import-TFnQkHmR.js";import"./import-9JVOK46k.js";import"./chunk-M3MASYO7-ejE7e--3.js";import"./import-MOaatX3q.js";import"./objectWithoutPropertiesLoose-pdUxmcoj.js";function be({match:l}){const[s,i]=n.useState([]),[r,c]=n.useState(!0);return n.useEffect(()=>{l&&(async(d,u)=>{const j=await ie(d,u);if(j.ok){const{response:x}=await j.json();i([...x[0].red_cards,...x[1].red_cards])}c(!1)})(l.tournament_id._id,l._id)},[l]),e.jsxs("div",{className:"flex justify-center gap-10 p-5 px-20 mx-auto mt-16",children:[e.jsx(D,{title:"JUEGO LIMPIO",isFetching:r,targets:!0,children:e.jsx(O,{items:[l.fair_play],tournament:!1})}),e.jsx(D,{title:"MEJOR JUGADOR",isFetching:r,targets:!0,children:e.jsx(O,{items:[l.best_player],tournament:!1})}),e.jsx(D,{title:"tarjetas rojas 🟥",isFetching:r,targets:!0,children:e.jsx(O,{items:s,tournament:!1})})]})}function Pe({infoHeader:l,match:s}){return e.jsxs("div",{className:"mb-6 text-center lg:px-3",children:[e.jsx("h1",{className:"text-xl font-bold uppercase lg:text-3xl",children:l==null?void 0:l.name}),e.jsx("span",{className:"font-semibold uppercase text-default-400",children:`${oe(s.date).add(1,"days").format("DD-MM-YYYY")} - ${l==null?void 0:l.time}`})]})}const ve=function({match:s,targetLocal:i,targetVisit:r}){var c,o;return e.jsxs("div",{className:"flex items-start justify-between max-w-6xl gap-5 pt-5 mx-auto lg:mt-10",children:[e.jsxs("div",{className:"flex flex-col items-center justify-end w-full",children:[e.jsx("p",{className:"text-default-400",children:"Local"}),e.jsx("h2",{className:"text-lg font-bold uppercase lg:text-2xl",children:(c=s==null?void 0:s.local)==null?void 0:c.team_id.name}),e.jsx("p",{className:`${(s==null?void 0:s.res_local)>(s==null?void 0:s.res_visit)?"text-success shadow-green-600 rounded-md shadow":"rounded-md shadow shadow-white"} p-5 m-5  text-7xl text-extrabold`,children:s==null?void 0:s.res_local}),e.jsx("p",{className:`${i!=null&&i.message?"":"text-default-400"} p-5`,children:(i==null?void 0:i.message)||"No hay mensaje"})]}),e.jsxs("div",{className:"flex flex-col items-center justify-end w-full",children:[e.jsx("p",{className:"text-default-400",children:"Visitante"}),e.jsx("h2",{className:"text-lg font-bold uppercase lg:text-2xl",children:(o=s==null?void 0:s.visit)==null?void 0:o.team_id.name}),e.jsx("p",{className:`${(s==null?void 0:s.res_visit)>(s==null?void 0:s.res_local)?"text-success shadow-green-600 rounded-md shadow":"rounded-md shadow shadow-white"} p-5 m-5  text-7xl text-extrabold`,children:s==null?void 0:s.res_visit}),e.jsx("p",{className:`${r!=null&&r.message?"":"text-default-400"} p-5`,children:(r==null?void 0:r.message)||"No hay mensaje"})]})]})},we=ve,Ne=we,H=({isLocal:l,match:s,handleResults:i,handleTarget:r,target:c,defaultRedCards:o,valueTarget:d,players:u,handleSelectionChange:j,playersWithRedCards:x,bestAndFairPlayerExist:N,bestPlayer:P,setBestPlayer:m,otherBestPlayer:h,best_player:b,handleBestPlayer:B,fairPlay:g,setFairPlay:F,otherFairPlay:v,fair_play:M,handleFairPlayer:w})=>{var S,C,$,_;return e.jsxs("div",{className:"block w-full col-span-6",children:[e.jsx("h2",{className:"text-xl uppercase",children:l?(C=(S=s.local)==null?void 0:S.team_id)==null?void 0:C.name:(_=($=s.visit)==null?void 0:$.team_id)==null?void 0:_.name}),e.jsx(W,{size:"sm",variant:"underlined",type:"number",min:"0",step:"1",placeholder:"Goles anotados",startContent:pe,defaultValue:l?s.res_local:s.res_visit,name:l?"res_local":"res_visit",onChange:a=>i(a)}),e.jsx(W,{size:"sm",variant:"underlined",type:"number",min:"0",step:"1",placeholder:"Tarjetas Amarillas",startContent:e.jsx("span",{children:"🟨"}),defaultValue:c==null?void 0:c.yellow_card,name:"yellow_card",onChange:a=>r(a)}),e.jsx(W,{size:"sm",type:"number",variant:"underlined",min:"0",step:"1",placeholder:"Tarjetas Rojas",startContent:e.jsx("span",{children:"🟥"}),defaultValue:(o==null?void 0:o.length)||0,name:"red_card",onChange:a=>r(a)}),e.jsx("div",{className:"h-16",children:(d==null?void 0:d.red_card)>0&&(u!=null&&u.length)?e.jsx(z,{label:"Asignar tarjeta roja",isRequired:!0,className:"col-span-4",variant:"underlined",selectionMode:d.red_card>1?"multiple":"single",selectedKeys:x??o,onChange:a=>j(a,l),children:u.map(a=>e.jsx(J,{value:a._id,children:`${a.first_name+" "+a.last_name}`},`${a._id}`))}):(d==null?void 0:d.red_card)>0?e.jsx("div",{className:"flex justify-center w-full mt-3",children:e.jsx(V,{})}):null}),e.jsx(me,{placeholder:"Mensaje",className:"pt-5 ",name:"message",defaultValue:c.message,onChange:a=>r(a)}),N?e.jsxs(e.Fragment,{children:[e.jsx(Z,{isSelected:P,onValueChange:m,className:"mt-3",isDisabled:h,children:"Mejor Jugador"}),P&&e.jsx(z,{"aria-label":"Best Local Player",placeholder:"Selecciona al mejor jugador",variant:"underlined",name:"best_player",value:b,onChange:B,children:u.map(a=>e.jsx(J,{value:a._id,children:`${a.first_name+" "+a.last_name}`},`${a._id}`))}),e.jsxs("div",{children:[e.jsx(Z,{isSelected:g,onValueChange:F,className:"mt-3",isDisabled:v,children:"Juego Limpio"}),g&&e.jsx(z,{"aria-label":"Fair Local Player",placeholder:"Selecciona juego limpio",variant:"underlined",name:"fair_play",value:M,defaultValue:(s==null?void 0:s.fair_play)||void 0,onChange:w,children:u.map(a=>e.jsx(J,{value:a._id,children:`${a.first_name+" "+a.last_name}`},a._id))})]})]}):null]})},ge=({onClose:l,match:s,targetL:i,targetV:r,targetLocal:c,setTargetLocal:o,targetVisit:d,setTargetVisit:u,defaultRedCardLocal:j,defaultRedCardVisit:x,localPlayers:N,visitPlayers:P,targets:m,bestAndFairPlayerExist:h,setbestAndFairPlayerExist:b})=>{var K,Q;const{setRefresh:B}=L(),[g,F]=n.useState({res_local:s==null?void 0:s.res_local,res_visit:s==null?void 0:s.res_visit}),[v,M]=n.useState(),[w,S]=n.useState(),[C,$]=n.useState(!1),[_,a]=n.useState(!1),[p,E]=n.useState((K=s==null?void 0:s.best_player)==null?void 0:K._id),[k,R]=n.useState(!1),[G,le]=n.useState(!1),[I,ae]=n.useState((Q=s==null?void 0:s.fair_play)==null?void 0:Q._id),T=y=>{const{name:f,value:t}=y.target;F(t===""?A=>({...A,[f]:f==="res_local"?s.res_local:s.res_visit}):A=>({...A,[f]:Number(t)}))},re=y=>{const{name:f,value:t}=y.target;if(f==="yellow_card"&&t===""&&o({...c,yellow_card:Number(i.yellow_card)}),f==="red_card"){if(t==="")return o({...c,red_card:i.red_cards.length});t==0&&M([])}if(f==="message"){if(t===""){o({...c,message:i.message});return}o({...c,message:t})}else o({...c,[f]:Number(t)})},te=y=>{const{name:f,value:t}=y.target;if(f==="yellow_card"&&t===""){u({...d,yellow_card:Number(r.yellow_card)});return}if(f==="red_card"){if(t==="")return u({...d,red_card:r.red_cards.length});t==0&&S([])}if(f==="message"){if(t===""){u({...d,message:r.message});return}u({...d,message:t})}else u({...d,[f]:Number(t)})},Y=(y,f)=>{const t=y.target.value;if(f){M(t.split(","));return}else{S(t.split(","));return}},q=y=>{const{value:f}=y.target;E(f)},U=y=>{const{name:f,value:t}=y.target;ae(t)},ne=async y=>{const f={res_local:g.res_local??s.res_local,res_visit:g.res_visit??s.res_visit,targetLocal:c,targetVisit:d,best_player:p,fair_play:I,targetLocal_id:m.local,targetVisit_id:m.visit,redCards:{localPlayersWithRedCards:v??i.red_cards.map(t=>t._id),visitPlayersWithRedCards:w??r.red_cards.map(t=>t._id)}};if(v&&v.length!==c.red_card||w&&w.length!==d.red_card){X.error("El número de 🟥 no coincide con la cantidad de jugadores");return}X.promise(async()=>{try{if((await fetch(`http://localhost:8080/api/matches/results/${s._id}`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",token:se},body:JSON.stringify(f)})).ok)return B(),"Datos cargados con éxito 😀"}catch(t){return console.log(t),"Algo salio mal 😮‍💨"}finally{y()}},{loading:"Loading...",success:t=>t,error:t=>t.message})};return e.jsxs("form",{className:"flex flex-col gap-10",children:[e.jsxs("div",{className:"flex gap-10",children:[e.jsx(H,{isLocal:!0,match:s,handleResults:T,handleTarget:re,target:i,defaultRedCards:j,valueTarget:c,players:N,handleSelectionChange:Y,playersWithRedCards:v,bestAndFairPlayerExist:h,bestPlayer:C,setBestPlayer:$,otherBestPlayer:_,best_player:p,handleBestPlayer:q,fairPlay:k,setFairPlay:R,otherFairPlay:G,fair_play:I,handleFairPlayer:U}),e.jsx(H,{isLocal:!1,match:s,handleResults:T,handleTarget:te,target:r,defaultRedCards:x,valueTarget:d,players:P,handleSelectionChange:Y,playersWithRedCards:w,bestAndFairPlayerExist:h,bestPlayer:_,setBestPlayer:a,otherBestPlayer:C,best_player:p,handleBestPlayer:q,fairPlay:G,setFairPlay:le,otherFairPlay:k,fair_play:I,handleFairPlayer:U})]}),e.jsx(ee,{className:"z-0 order-last w-full font-semibold uppercase bg-primary/60 hover:bg-primary",variant:"solid",radius:"sm",startContent:xe,onPress:()=>{ne(l)},children:"Guardar"})]})},Se=ge;function Ce({match:l,tournamentId:s,targetL:i,targetV:r}){const{isOpen:c,onOpen:o,onOpenChange:d}=de(),[u,j]=n.useState(!0),[x,N]=n.useState({red_card:i==null?void 0:i.red_cards.length,yellow_card:i==null?void 0:i.yellow_card,message:i==null?void 0:i.message}),[P,m]=n.useState({red_card:r==null?void 0:r.red_cards.length,yellow_card:r==null?void 0:r.yellow_card,message:r==null?void 0:r.message}),[h,b]=n.useState(null),[B,g]=n.useState(),[F,v]=n.useState(),[M,w]=n.useState([]),[S,C]=n.useState([]);n.useEffect(()=>{var _,a;j(!0),(_=l==null?void 0:l.best_player)!=null&&_._id&&((a=l==null?void 0:l.fair_play)!=null&&a._id)&&j(!1)},[l,d]),n.useEffect(()=>{l&&(async()=>{try{const a=await fetch(`http://localhost:8080/api/targets/tournament/${s}/match/${l._id}`);if(!a.ok){console.log("Algo salio mal en el fetch");return}const{response:p}=await a.json(),E=p.find(R=>R.team_id._id===l.local.team_id._id),k=p.find(R=>R.team_id._id===l.visit.team_id._id);b({local:E._id,visit:k._id})}catch(a){console.error(a)}})()},[s,l._id]);const $=async(_,a)=>{try{const p=await fetch(`http://localhost:8080/api/players/all/?team=${_}`,{method:"GET",credentials:"include",headers:{token:se}});if(p.ok){const{response:E}=await p.json();a?w(E):C(E)}}catch(p){throw new Error(p)}};return n.useEffect(()=>{$(l.local.team_id._id,!0)},[x]),n.useEffect(()=>{$(l.visit.team_id._id,!1)},[P]),n.useEffect(()=>{const _=i.red_cards.map(p=>p._id);g(_);const a=r.red_cards.map(p=>p._id);v(a)},[]),e.jsxs(e.Fragment,{children:[e.jsx(ee,{onPress:o,color:"primary",size:"sm",endContent:e.jsx(ye,{size:16}),className:"top-0 right-0 flex font-semibold hover:text-white ms-auto",children:"Editar"}),e.jsx(ce,{isOpen:c,onOpenChange:d,size:"4xl",className:"w-full border dark text-foreground border-default-400",children:e.jsx(ue,{children:_=>e.jsxs(e.Fragment,{children:[e.jsx(je,{className:"flex flex-col gap-1",children:"Carga de datos"}),e.jsx(he,{children:e.jsx(Se,{onClose:_,match:l,targetL:i,targetV:r,targetLocal:x,setTargetLocal:N,targetVisit:P,setTargetVisit:m,defaultRedCardLocal:B,defaultRedCardVisit:F,localPlayers:M,visitPlayers:S,targets:h,bestAndFairPlayerExist:u,setbestAndFairPlayerExist:j})})]})})})]})}function qe(){const{id:l}=fe(),{isHiddenTopBar:s,refresh:i}=L(),[r,c]=n.useState(),[o,d]=n.useState(null),[u,j]=n.useState(),[x,N]=n.useState();return n.useEffect(()=>{l&&(async m=>{const h=await _e(m);if(h.ok){const{response:b}=await h.json();d(b),c(b.tournament_id)}})(l)},[l,i]),n.useEffect(()=>{async function P(){try{const m=await fetch(`http://localhost:8080/api/targets/tournament/${o.tournament_id._id}/match/${o._id}`);if(m.ok){const{response:h}=await m.json();j(h.filter(b=>b.team_id._id===o.local.team_id._id)[0]),N(h.filter(b=>b.team_id._id===o.visit.team_id._id)[0])}}catch(m){console.log(m)}}o&&P()},[o]),o?e.jsxs("section",{className:`${s?"pt-12":"pt-36"} absolute top-0 left-0 w-full pl-5 lg:pl-[200px] pb-16  lg:pt-20 pr-5 overflow-y-scroll h-screen bg-black`,children:[u&&x?e.jsx(Ce,{match:o,tournamentId:o.tournament_id._id,targetL:u,targetV:x}):null,e.jsx(Pe,{infoHeader:r,match:o}),e.jsx(Ne,{match:o,targetLocal:u,targetVisit:x}),e.jsx(be,{match:o,targetLocal:u,targetVisit:x})]}):e.jsx("div",{className:`${s?"pt-12":"pt-36"} absolute top-0 left-0 flex justify-center items-center w-full pl-5 lg:pl-[200px] pb-16  lg:pt-20 pr-5 overflow-y-scroll h-screen bg-black`,children:e.jsx(V,{})})}export{qe as default};
