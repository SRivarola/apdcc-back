import{r as i,j as e,s as j,g as x,u as y,k as w,b as f,m as _,a as C,l as b,A as N}from"./index-ud7WvSZc.js";import{c as T,g as $}from"./chunk-OFH6WYRQ-VrSlWUnV.js";import{m as k,t as F,a as I,b as L,c as A,d as M,e as R}from"./chunk-YRZGWF2W-zd0TKMqz.js";import{m as S}from"./chunk-EPDLEVDR-0vwhT5A0.js";import{m as v,P as z,p as D}from"./pen-square-MRu9I7uJ.js";import{S as q}from"./search-2AweBpUQ.js";import"./chunk-AMSULWPV-YtnjV3Dt.js";function V({id:m}){const[d,u]=i.useState(!0),[l,s]=i.useState(null);return i.useEffect(()=>{(async()=>{const p=localStorage.getItem("apdcc_token");try{const o=await fetch(`https://apdcc-back-production.up.railway.app/api/auth/bycountry/${m}`,{method:"GET",credentials:"include",headers:{token:p}});if(o.ok){const r=await o.json();s(r)}}catch(o){console.error(o)}finally{u(!1)}})()},[]),d?e.jsx(j,{}):l?e.jsxs("p",{children:[l.first_name," ",l.last_name]}):e.jsx(T,{color:"warning",variant:"flat",children:"No asignado"})}function B(){const{setRefresh:m}=x(),{isOpen:d,onOpen:u,onOpenChange:l}=y(),{register:s,handleSubmit:h,formState:{errors:p}}=w({defaultValues:{name:""}}),o=async r=>{N.promise(async()=>{const t=localStorage.getItem("apdcc_token");try{if((await fetch("https://apdcc-back-production.up.railway.app/api/countries/create",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",token:t},body:JSON.stringify(r)})).ok)return m(),"Country creado con éxito 😀";throw new Error("Oops, algo salió mal 😕")}catch(c){throw new Error("Error al procesar la solicitud: "+c.message)}},{loading:"Loading...",success:t=>t,error:t=>t.message})};return e.jsxs(e.Fragment,{children:[e.jsx(f,{onPress:u,variant:"faded",color:"default",className:"mb-3",radius:"sm",children:"Nuevo Country"}),e.jsx(_,{isOpen:d,onOpenChange:l,className:"border dark text-foreground border-default-400",children:e.jsx(C,{children:r=>e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"flex flex-col gap-1",children:"Crear Nuevo Country"}),e.jsx(S,{children:e.jsx(b,{placeholder:"Ingrese el nombre",variant:"underlined",label:"Nombre",isRequired:!0,...s("name")})}),e.jsx(v,{children:e.jsx(f,{className:"uppercase font-semibold bg-primary/60 hover:bg-primary",type:"submit",radius:"sm",onPress:()=>{h(o)(),r()},children:"Crear"})})]})})})]})}function G({id:m}){const{setRefresh:d}=x(),{isOpen:u,onOpen:l,onOpenChange:s}=y(),{register:h,handleSubmit:p}=w({defaultValues:{name:""}}),o=async r=>{N.promise(async()=>{const t=localStorage.getItem("apdcc_token");try{if((await fetch(`https://apdcc-back-production.up.railway.app/api/countries/${m}`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",token:t},body:JSON.stringify(r)})).ok)return d(),"¡Country editado con éxito! 😄";throw new Error("Oops, algo salió mal 😕")}catch(c){throw new Error("Error al procesar la solicitud: "+c.message)}},{loading:"Loading...",success:t=>t,error:t=>t.message})};return e.jsxs(e.Fragment,{children:[e.jsx(f,{isIconOnly:!0,onPress:l,color:"default",size:"sm",className:"bg-default/50 text-default-400 hover:text-white",children:e.jsx(z,{size:18})}),e.jsx(_,{isOpen:u,onOpenChange:s,className:"border dark text-foreground border-default-400",children:e.jsx(C,{children:r=>e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"flex flex-col gap-1 uppercase",children:"⚠️ Advertencia"}),e.jsxs(S,{children:[e.jsx("div",{children:"Esta acción es permanente y no se puede deshacer."}),e.jsx(b,{placeholder:"Nuevo nombre",label:"Nombre",isRequired:!0,variant:"underlined",...h("name")})]}),e.jsx(v,{children:e.jsx(f,{className:"uppercase font-semibold bg-primary/60 hover:bg-primary",variant:"solid",radius:"sm",onPress:()=>{p(o)(),r()},children:"Editar"})})]})})})]})}const J=[{label:"country",key:"name"},{label:"manager",key:"manager"},{label:"acciones",key:"actions"}],U=function(){const d=localStorage.getItem("apdcc_token"),{refresh:u,isHiddenTopBar:l}=x(),[s,h]=i.useState({docs:[],totalDocs:0,limit:10,totalPages:0,page:0,pagingCounter:0,hasPrevPage:!1,hasNextPage:!1,prevPage:null,nextPage:null}),[p,o]=i.useState([]),[r,t]=i.useState(!0),[c,P]=i.useState(1);i.useEffect(()=>{(async()=>{const n=`https://apdcc-back-production.up.railway.app/api/countries?page=${c}`;try{const g=await fetch(n,{method:"GET",credentials:"include",headers:{token:d}});if(g.ok){const O=await g.json();h(O.response)}}catch(g){throw new Error(g)}finally{t(!1)}})()},[c,u]);const E=a=>{const n=s.docs.filter(g=>g.name.toLowerCase().includes(a.toLowerCase()));n.length&&o(n)};return e.jsxs("section",{className:` ${l?"pt-12":"pt-36"} absolute top-0 left-0 w-full pl-5 lg:pl-[200px] pb-16 lg:pt-20 pr-5 overflow-y-scroll h-screen bg-black`,children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between w-full gap-4 pb-4 ",children:[e.jsx(B,{}),e.jsx(b,{startContent:e.jsx(q,{}),type:"search",size:"sm",variant:"underlined",placeholder:"Buscar",color:"warning",className:"w-[180px]",onChange:a=>{var n;return E((n=a.target)==null?void 0:n.value)}})]}),e.jsxs("div",{className:"flex items-center justify-between px-3",children:[e.jsxs("p",{className:"mb-2 text-default-400 text-small",children:["Total ",s.totalDocs," countries"]}),e.jsxs("p",{className:"mb-2 text-default-400 text-small",children:["Página ",s.page]})]}),e.jsxs(F,{"aria-label":"Users Table",bottomContent:s.page>0?e.jsx("div",{className:`${s.docs?"opacity-100":"opacity-0"} flex items-center justify-center w-full gap-4`,children:e.jsx(D,{isCompact:!0,showControls:!0,showShadow:!0,color:"primary",page:s.page,total:s.totalPages,onChange:a=>P(a)})}):null,children:[e.jsx(I,{columns:J,children:a=>e.jsx(L,{className:"uppercase",allowsSorting:a.key!=="country"&&a.key!=="actions",children:a.label},a.key)}),e.jsx(A,{emptyContent:r?" ":s.docs.length===0?"No se encontraron countries":"",items:p.length?p:s.docs,isLoading:r,loadingContent:e.jsx(j,{className:"mt-12",label:"Loading..."}),children:a=>e.jsx(M,{children:n=>e.jsxs(R,{className:"capitalize",children:[n==="manager"&&e.jsx(V,{id:a._id}),n==="actions"?e.jsx("div",{className:"flex items-center gap-3",children:e.jsx(G,{id:a._id})}):$(a,n)]})},a.name)})]})]})},ee=U;export{ee as default};
