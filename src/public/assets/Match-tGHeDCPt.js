import{r as n,j as e,a7 as de,s as ee,h as se,b as I,A,t as U,a as ce,m as ue,c as fe,p as pe,a8 as _e}from"./index-iAvMSn7O.js";import{S as D,F as z}from"./SectionContainer-HhiDLsNK.js";import{h as me}from"./moment-WSJ9un1t.js";import{b as xe,s as ye}from"./ballIcon-OqZMHW6T.js";import{i as J}from"./chunk-TC4QW7OA-awqbcFK6.js";import{s as T,l as G}from"./chunk-ZFWMN6TD-x4uwpBV7.js";import{t as je}from"./chunk-K3TANQWH-_tvLkwgP.js";import{c as L}from"./chunk-AMSULWPV-72_QTxLq.js";import{P as he}from"./pen-square-zKieONUn.js";import{m as be}from"./chunk-3S23ARPO-R4G7t9Cy.js";import{m as Pe}from"./chunk-EPDLEVDR-Zlm-YNY8.js";import"./chunk-YRZGWF2W-jOM1iz-C.js";import"./chunk-7F3ZLNJ6-Lre8nyzq.js";import"./import-GwI392wx.js";import"./import-Sb5K26Mj.js";import"./chunk-M3MASYO7-MF5-T0bH.js";import"./import-I6dRycQZ.js";import"./objectWithoutPropertiesLoose-pdUxmcoj.js";function we({match:l}){const[s,i]=n.useState([]),[t,u]=n.useState(!0);return n.useEffect(()=>{l&&(async(d,f)=>{const j=await de(d,f);if(j.ok){const{response:y}=await j.json();i([...y[0].red_cards,...y[1].red_cards])}u(!1)})(l.tournament_id._id,l._id)},[l]),e.jsxs("div",{className:"flex justify-center gap-10 p-5 px-20 mx-auto mt-16",children:[e.jsx(D,{title:"JUEGO LIMPIO",isFetching:t,targets:!0,children:e.jsx(z,{items:[l.fair_play],tournament:!1})}),e.jsx(D,{title:"MEJOR JUGADOR",isFetching:t,targets:!0,children:e.jsx(z,{items:[l.best_player],tournament:!1})}),e.jsx(D,{title:"tarjetas rojas 🟥",isFetching:t,targets:!0,children:e.jsx(z,{items:s,tournament:!1})})]})}function ve({infoHeader:l,match:s}){return e.jsxs("div",{className:"mb-6 text-center lg:px-3 flex flex-col",children:[e.jsx("h1",{className:"text-xl font-bold uppercase lg:text-3xl",children:l==null?void 0:l.name}),e.jsx("span",{className:"font-semibold uppercase text-default-400",children:`${me(s.date).add(1,"days").format("DD-MM-YYYY")} - ${l==null?void 0:l.time}`}),s.played==="suspended"?e.jsx("span",{className:"text-warning text-xl font-semibold uppercase",children:"partido suspendido"}):null,s.both_lose?e.jsx("span",{className:"text-danger text-xl font-semibold uppercase",children:"ambos equipos perdieron el partido"}):null]})}const ge=function({match:s,targetLocal:i,targetVisit:t}){var u,o;return e.jsxs("div",{className:"flex items-start justify-between max-w-6xl gap-5 pt-5 mx-auto lg:mt-10",children:[e.jsxs("div",{className:"flex flex-col items-center justify-end w-full",children:[e.jsx("p",{className:"text-default-400",children:"Local"}),e.jsx("h2",{className:"text-lg font-bold uppercase lg:text-2xl",children:(u=s==null?void 0:s.local)==null?void 0:u.team_id.name}),e.jsx("p",{className:`${(s==null?void 0:s.res_local)>(s==null?void 0:s.res_visit)?"text-success shadow-green-600 rounded-md shadow":"rounded-md shadow shadow-white"} p-5 m-5  text-7xl text-extrabold`,children:s==null?void 0:s.res_local}),e.jsx("p",{className:`${i!=null&&i.message?"":"text-default-400"} p-5`,children:(i==null?void 0:i.message)||"No hay mensaje"})]}),e.jsxs("div",{className:"flex flex-col items-center justify-end w-full",children:[e.jsx("p",{className:"text-default-400",children:"Visitante"}),e.jsx("h2",{className:"text-lg font-bold uppercase lg:text-2xl",children:(o=s==null?void 0:s.visit)==null?void 0:o.team_id.name}),e.jsx("p",{className:`${(s==null?void 0:s.res_visit)>(s==null?void 0:s.res_local)?"text-success shadow-green-600 rounded-md shadow":"rounded-md shadow shadow-white"} p-5 m-5  text-7xl text-extrabold`,children:s==null?void 0:s.res_visit}),e.jsx("p",{className:`${t!=null&&t.message?"":"text-default-400"} p-5`,children:(t==null?void 0:t.message)||"No hay mensaje"})]})]})},Ne=ge,Ce=Ne,V=({isLocal:l,match:s,handleResults:i,handleTarget:t,target:u,defaultRedCards:o,valueTarget:d,players:f,handleSelectionChange:j,playersWithRedCards:y,bestAndFairPlayerExist:g,bestPlayer:P,setBestPlayer:_,otherBestPlayer:h,best_player:b,handleBestPlayer:N,fairPlay:C,setFairPlay:M,otherFairPlay:w,fair_play:B,handleFairPlayer:v})=>{var S,$,F,m;return e.jsxs("div",{className:"block w-full col-span-6",children:[e.jsx("h2",{className:"text-xl uppercase",children:l?($=(S=s.local)==null?void 0:S.team_id)==null?void 0:$.name:(m=(F=s.visit)==null?void 0:F.team_id)==null?void 0:m.name}),e.jsx(J,{size:"sm",variant:"underlined",type:"number",min:"0",step:"1",placeholder:"Goles anotados",startContent:xe,defaultValue:l?s.res_local:s.res_visit,name:l?"res_local":"res_visit",onChange:r=>i(r)}),e.jsx(J,{size:"sm",variant:"underlined",type:"number",min:"0",step:"1",placeholder:"Tarjetas Amarillas",startContent:e.jsx("span",{children:"🟨"}),defaultValue:u==null?void 0:u.yellow_card,name:"yellow_card",onChange:r=>t(r)}),e.jsx(J,{size:"sm",type:"number",variant:"underlined",min:"0",step:"1",placeholder:"Tarjetas Rojas",startContent:e.jsx("span",{children:"🟥"}),defaultValue:(o==null?void 0:o.length)||0,name:"red_card",onChange:r=>t(r)}),e.jsx("div",{className:"h-16",children:(d==null?void 0:d.red_card)>0&&(f!=null&&f.length)?e.jsx(T,{label:"Asignar tarjeta roja",isRequired:!0,className:"col-span-4",variant:"underlined",selectionMode:d.red_card>1?"multiple":"single",selectedKeys:y??o,onChange:r=>j(r,l),children:f.map(r=>e.jsx(G,{value:r._id,children:`${r.first_name+" "+r.last_name}`},`${r._id}`))}):(d==null?void 0:d.red_card)>0?e.jsx("div",{className:"flex justify-center w-full mt-3",children:e.jsx(ee,{})}):null}),e.jsx(je,{placeholder:"Mensaje",className:"pt-5 ",name:"message",defaultValue:u.message,onChange:r=>t(r)}),g?e.jsxs(e.Fragment,{children:[e.jsx(L,{isSelected:P,onValueChange:_,className:"mt-3",isDisabled:h,children:"Mejor Jugador"}),P&&e.jsx(T,{"aria-label":"Best Local Player",placeholder:"Selecciona al mejor jugador",variant:"underlined",name:"best_player",value:b,onChange:N,children:f.map(r=>e.jsx(G,{value:r._id,children:`${r.first_name+" "+r.last_name}`},`${r._id}`))}),e.jsxs("div",{children:[e.jsx(L,{isSelected:C,onValueChange:M,className:"mt-3",isDisabled:w,children:"Juego Limpio"}),C&&e.jsx(T,{"aria-label":"Fair Local Player",placeholder:"Selecciona juego limpio",variant:"underlined",name:"fair_play",value:B,defaultValue:(s==null?void 0:s.fair_play)||void 0,onChange:v,children:f.map(r=>e.jsx(G,{value:r._id,children:`${r.first_name+" "+r.last_name}`},r._id))})]})]}):null]})},Se=({onClose:l,match:s,targetL:i,targetV:t,targetLocal:u,setTargetLocal:o,targetVisit:d,setTargetVisit:f,defaultRedCardLocal:j,defaultRedCardVisit:y,localPlayers:g,visitPlayers:P,targets:_,bestAndFairPlayerExist:h,setbestAndFairPlayerExist:b})=>{var Z,H;const{setRefresh:N}=se(),[C,M]=n.useState({res_local:s==null?void 0:s.res_local,res_visit:s==null?void 0:s.res_visit}),[w,B]=n.useState(),[v,S]=n.useState(),[$,F]=n.useState(!1),[m,r]=n.useState(!1),[x,E]=n.useState((Z=s==null?void 0:s.best_player)==null?void 0:Z._id),[k,R]=n.useState(!1),[Y,ae]=n.useState(!1),[O,le]=n.useState((H=s==null?void 0:s.fair_play)==null?void 0:H._id),q=p=>{const{name:c,value:a}=p.target;M(a===""?W=>({...W,[c]:c==="res_local"?s.res_local:s.res_visit}):W=>({...W,[c]:Number(a)}))},re=p=>{const{name:c,value:a}=p.target;if(c==="yellow_card"&&a===""&&o({...u,yellow_card:Number(i.yellow_card)}),c==="red_card"){if(a==="")return o({...u,red_card:i.red_cards.length});a==0&&B([])}if(c==="message"){if(a===""){o({...u,message:i.message});return}o({...u,message:a})}else o({...u,[c]:Number(a)})},te=p=>{const{name:c,value:a}=p.target;if(c==="yellow_card"&&a===""){f({...d,yellow_card:Number(t.yellow_card)});return}if(c==="red_card"){if(a==="")return f({...d,red_card:t.red_cards.length});a==0&&S([])}if(c==="message"){if(a===""){f({...d,message:t.message});return}f({...d,message:a})}else f({...d,[c]:Number(a)})},K=(p,c)=>{const a=p.target.value;if(c){B(a.split(","));return}else{S(a.split(","));return}},Q=p=>{const{value:c}=p.target;E(c)},X=p=>{const{name:c,value:a}=p.target;le(a)},ne=async p=>{const c={res_local:C.res_local??s.res_local,res_visit:C.res_visit??s.res_visit,both_lose:!1,targetLocal:u,targetVisit:d,best_player:x,fair_play:O,targetLocal_id:_.local,targetVisit_id:_.visit,redCards:{localPlayersWithRedCards:w??i.red_cards.map(a=>a._id),visitPlayersWithRedCards:v??t.red_cards.map(a=>a._id)}};if(w&&w.length!==u.red_card||v&&v.length!==d.red_card){A.error("El número de 🟥 no coincide con la cantidad de jugadores");return}A.promise(async()=>{try{if((await fetch(`https://apdcc.com.ar/api/matches/results/${s._id}`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",token:U},body:JSON.stringify(c)})).ok)return N(),"Datos cargados con éxito 😀"}catch(a){return console.log(a),"Algo salio mal 😮‍💨"}finally{p()}},{loading:"Loading...",success:a=>a,error:a=>a.message})},ie=p=>{const c={targetLocal_id:_.local,targetVisit_id:_.visit,redCards:{localPlayersWithRedCards:w||[],visitPlayersWithRedCards:v||[]},targetLocal:u,targetVisit:d};A.promise(async()=>{try{if((await fetch(`https://apdcc.com.ar/api/matches/bothloose/${s._id}`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",token:U},body:JSON.stringify(c)})).ok)return N(),"Partdo actualizado con éxito 😀"}catch(a){return console.log(a),"Algo salio mal 😮‍💨"}finally{p()}},{loading:"Loading...",success:a=>a,error:a=>a.message})},oe=p=>{const c={played:"suspended"};A.promise(async()=>{try{if((await fetch(`https://apdcc.com.ar/api/matches/results/${s._id}`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)})).ok)return N(),"Partdo suspendido con éxito 😀"}catch(a){return console.log(a),"Algo salio mal 😮‍💨"}finally{p()}},{loading:"Loading...",success:a=>a,error:a=>a.message})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"absolute top-4 right-4 flex gap-4",children:[e.jsx(I,{radius:"sm",color:"warning",className:"uppercase font-semibold",onPress:()=>oe(l),children:"suspender"}),e.jsx(I,{radius:"sm",color:"danger",className:"uppercase font-semibold",onPress:()=>ie(l),children:"ambos pierden"})]}),e.jsxs("form",{className:"flex flex-col gap-10",children:[e.jsxs("div",{className:"flex gap-10",children:[e.jsx(V,{isLocal:!0,match:s,handleResults:q,handleTarget:re,target:i,defaultRedCards:j,valueTarget:u,players:g,handleSelectionChange:K,playersWithRedCards:w,bestAndFairPlayerExist:h,bestPlayer:$,setBestPlayer:F,otherBestPlayer:m,best_player:x,handleBestPlayer:Q,fairPlay:k,setFairPlay:R,otherFairPlay:Y,fair_play:O,handleFairPlayer:X}),e.jsx(V,{isLocal:!1,match:s,handleResults:q,handleTarget:te,target:t,defaultRedCards:y,valueTarget:d,players:P,handleSelectionChange:K,playersWithRedCards:v,bestAndFairPlayerExist:h,bestPlayer:m,setBestPlayer:r,otherBestPlayer:$,best_player:x,handleBestPlayer:Q,fairPlay:Y,setFairPlay:ae,otherFairPlay:k,fair_play:O,handleFairPlayer:X})]}),e.jsx(I,{className:"z-0 order-last w-full font-semibold uppercase bg-primary/60 hover:bg-primary",variant:"solid",radius:"sm",startContent:ye,onPress:()=>{ne(l)},children:"Guardar"})]})]})},$e=Se;function Fe({match:l,tournamentId:s,targetL:i,targetV:t}){const{isOpen:u,onOpen:o,onOpenChange:d}=ce(),[f,j]=n.useState(!0),[y,g]=n.useState({red_card:i==null?void 0:i.red_cards.length,yellow_card:i==null?void 0:i.yellow_card,message:i==null?void 0:i.message}),[P,_]=n.useState({red_card:t==null?void 0:t.red_cards.length,yellow_card:t==null?void 0:t.yellow_card,message:t==null?void 0:t.message}),[h,b]=n.useState(null),[N,C]=n.useState(),[M,w]=n.useState(),[B,v]=n.useState([]),[S,$]=n.useState([]),F=async(m,r)=>{try{const x=await fetch(`https://apdcc.com.ar/api/players/all/?team=${m}`,{method:"GET",credentials:"include",headers:{token:U}});if(x.ok){const{response:E}=await x.json();r?v(E):$(E)}}catch(x){throw new Error(x)}};return n.useEffect(()=>{var m,r;j(!0),(m=l==null?void 0:l.best_player)!=null&&m._id&&((r=l==null?void 0:l.fair_play)!=null&&r._id)&&j(!1)},[l,d]),n.useEffect(()=>{l&&(async()=>{try{const r=await fetch(`https://apdcc.com.ar/api/targets/tournament/${s}/match/${l._id}`);if(!r.ok){console.log("Algo salio mal en el fetch");return}const{response:x}=await r.json(),E=x.find(R=>R.team_id._id===l.local.team_id._id),k=x.find(R=>R.team_id._id===l.visit.team_id._id);b({local:E._id,visit:k._id})}catch(r){console.error(r)}})()},[s,l._id]),n.useEffect(()=>{F(l.local.team_id._id,!0)},[y]),n.useEffect(()=>{F(l.visit.team_id._id,!1)},[P]),n.useEffect(()=>{const m=i.red_cards.map(x=>x._id);C(m);const r=t.red_cards.map(x=>x._id);w(r)},[]),e.jsxs(e.Fragment,{children:[e.jsx(I,{onPress:o,color:"primary",size:"sm",endContent:e.jsx(he,{size:16}),className:"top-0 right-0 flex font-semibold hover:text-white ms-auto",children:"Editar"}),e.jsx(ue,{isOpen:u,onOpenChange:d,hideCloseButton:!0,size:"4xl",className:"w-full border dark text-foreground border-default-400",children:e.jsx(fe,{children:m=>e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"flex gap-1 items-center justify-between",children:e.jsx("p",{children:"Carga de datos"})}),e.jsx(Pe,{children:e.jsx($e,{onClose:m,match:l,targetL:i,targetV:t,targetLocal:y,setTargetLocal:g,targetVisit:P,setTargetVisit:_,defaultRedCardLocal:N,defaultRedCardVisit:M,localPlayers:B,visitPlayers:S,targets:h,bestAndFairPlayerExist:f,setbestAndFairPlayerExist:j})})]})})})]})}function Qe(){const{id:l}=pe(),{isHiddenTopBar:s,refresh:i}=se(),[t,u]=n.useState(),[o,d]=n.useState(null),[f,j]=n.useState(),[y,g]=n.useState();return n.useEffect(()=>{l&&(async _=>{const h=await _e(_);if(h.ok){const{response:b}=await h.json();d(b),u(b.tournament_id)}})(l)},[l,i]),n.useEffect(()=>{async function P(){try{const _=await fetch(`https://apdcc.com.ar/api/targets/tournament/${o.tournament_id._id}/match/${o._id}`);if(_.ok){const{response:h}=await _.json();j(h.filter(b=>b.team_id._id===o.local.team_id._id)[0]),g(h.filter(b=>b.team_id._id===o.visit.team_id._id)[0])}}catch(_){console.log(_)}}o&&P()},[o]),o?e.jsxs("section",{className:`${s?"pt-12":"pt-36"} absolute top-0 left-0 w-full pl-5 lg:pl-[200px] pb-16  lg:pt-20 pr-5 overflow-y-scroll h-screen bg-black`,children:[f&&y?e.jsx(Fe,{match:o,tournamentId:o.tournament_id._id,targetL:f,targetV:y}):null,e.jsx(ve,{infoHeader:t,match:o}),e.jsx(Ce,{match:o,targetLocal:f,targetVisit:y}),e.jsx(we,{match:o,targetLocal:f,targetVisit:y})]}):e.jsx("div",{className:`${s?"pt-12":"pt-36"} absolute top-0 left-0 flex justify-center items-center w-full pl-5 lg:pl-[200px] pb-16  lg:pt-20 pr-5 overflow-y-scroll h-screen bg-black`,children:e.jsx(ee,{})})}export{Qe as default};
