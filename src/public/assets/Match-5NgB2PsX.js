import{r as n,j as e,a7 as oe,s as ee,h as se,b as G,A as W,t as U,a as de,m as ce,c as ue,p as fe,a8 as pe}from"./index-9WEvcQma.js";import{S as D,F as O}from"./SectionContainer-dhqhGREU.js";import{h as _e}from"./moment-WSJ9un1t.js";import{b as me,s as xe}from"./ballIcon-3UR0us07.js";import{i as z}from"./chunk-TC4QW7OA-C5f0qroe.js";import{s as J,l as T}from"./chunk-ZFWMN6TD-GDovlbII.js";import{t as ye}from"./chunk-K3TANQWH-ZtYYaelG.js";import{c as L}from"./chunk-AMSULWPV-erguprBd.js";import{P as je}from"./pen-square-S5SeMiVy.js";import{m as he}from"./chunk-3S23ARPO-n8tCgX3R.js";import{m as be}from"./chunk-EPDLEVDR-8OB71Cda.js";import"./chunk-YRZGWF2W--UDlJNcx.js";import"./chunk-7F3ZLNJ6-AxV_OLjI.js";import"./import-CvSfAawK.js";import"./import-BkT9mAKY.js";import"./chunk-M3MASYO7-7JnxCq02.js";import"./import-OoU27xZZ.js";import"./objectWithoutPropertiesLoose-pdUxmcoj.js";function Pe({match:a}){const[s,i]=n.useState([]),[t,c]=n.useState(!0);return n.useEffect(()=>{a&&(async(d,f)=>{const j=await oe(d,f);if(j.ok){const{response:y}=await j.json();i([...y[0].red_cards,...y[1].red_cards])}c(!1)})(a.tournament_id._id,a._id)},[a]),e.jsxs("div",{className:"flex justify-center gap-10 p-5 px-20 mx-auto mt-16",children:[e.jsx(D,{title:"JUEGO LIMPIO",isFetching:t,targets:!0,children:e.jsx(O,{items:[a.fair_play],tournament:!1})}),e.jsx(D,{title:"MEJOR JUGADOR",isFetching:t,targets:!0,children:e.jsx(O,{items:[a.best_player],tournament:!1})}),e.jsx(D,{title:"tarjetas rojas 🟥",isFetching:t,targets:!0,children:e.jsx(O,{items:s,tournament:!1})})]})}function ve({infoHeader:a,match:s}){return e.jsxs("div",{className:"mb-6 text-center lg:px-3",children:[e.jsx("h1",{className:"text-xl font-bold uppercase lg:text-3xl",children:a==null?void 0:a.name}),e.jsx("span",{className:"font-semibold uppercase text-default-400",children:`${_e(s.date).add(1,"days").format("DD-MM-YYYY")} - ${a==null?void 0:a.time}`})]})}const we=function({match:s,targetLocal:i,targetVisit:t}){var c,o;return e.jsxs("div",{className:"flex items-start justify-between max-w-6xl gap-5 pt-5 mx-auto lg:mt-10",children:[e.jsxs("div",{className:"flex flex-col items-center justify-end w-full",children:[e.jsx("p",{className:"text-default-400",children:"Local"}),e.jsx("h2",{className:"text-lg font-bold uppercase lg:text-2xl",children:(c=s==null?void 0:s.local)==null?void 0:c.team_id.name}),e.jsx("p",{className:`${(s==null?void 0:s.res_local)>(s==null?void 0:s.res_visit)?"text-success shadow-green-600 rounded-md shadow":"rounded-md shadow shadow-white"} p-5 m-5  text-7xl text-extrabold`,children:s==null?void 0:s.res_local}),e.jsx("p",{className:`${i!=null&&i.message?"":"text-default-400"} p-5`,children:(i==null?void 0:i.message)||"No hay mensaje"})]}),e.jsxs("div",{className:"flex flex-col items-center justify-end w-full",children:[e.jsx("p",{className:"text-default-400",children:"Visitante"}),e.jsx("h2",{className:"text-lg font-bold uppercase lg:text-2xl",children:(o=s==null?void 0:s.visit)==null?void 0:o.team_id.name}),e.jsx("p",{className:`${(s==null?void 0:s.res_visit)>(s==null?void 0:s.res_local)?"text-success shadow-green-600 rounded-md shadow":"rounded-md shadow shadow-white"} p-5 m-5  text-7xl text-extrabold`,children:s==null?void 0:s.res_visit}),e.jsx("p",{className:`${t!=null&&t.message?"":"text-default-400"} p-5`,children:(t==null?void 0:t.message)||"No hay mensaje"})]})]})},ge=we,Ne=ge,V=({isLocal:a,match:s,handleResults:i,handleTarget:t,target:c,defaultRedCards:o,valueTarget:d,players:f,handleSelectionChange:j,playersWithRedCards:y,bestAndFairPlayerExist:g,bestPlayer:P,setBestPlayer:p,otherBestPlayer:h,best_player:b,handleBestPlayer:F,fairPlay:N,setFairPlay:M,otherFairPlay:v,fair_play:B,handleFairPlayer:w})=>{var C,S,$,_;return e.jsxs("div",{className:"block w-full col-span-6",children:[e.jsx("h2",{className:"text-xl uppercase",children:a?(S=(C=s.local)==null?void 0:C.team_id)==null?void 0:S.name:(_=($=s.visit)==null?void 0:$.team_id)==null?void 0:_.name}),e.jsx(z,{size:"sm",variant:"underlined",type:"number",min:"0",step:"1",placeholder:"Goles anotados",startContent:me,defaultValue:a?s.res_local:s.res_visit,name:a?"res_local":"res_visit",onChange:r=>i(r)}),e.jsx(z,{size:"sm",variant:"underlined",type:"number",min:"0",step:"1",placeholder:"Tarjetas Amarillas",startContent:e.jsx("span",{children:"🟨"}),defaultValue:c==null?void 0:c.yellow_card,name:"yellow_card",onChange:r=>t(r)}),e.jsx(z,{size:"sm",type:"number",variant:"underlined",min:"0",step:"1",placeholder:"Tarjetas Rojas",startContent:e.jsx("span",{children:"🟥"}),defaultValue:(o==null?void 0:o.length)||0,name:"red_card",onChange:r=>t(r)}),e.jsx("div",{className:"h-16",children:(d==null?void 0:d.red_card)>0&&(f!=null&&f.length)?e.jsx(J,{label:"Asignar tarjeta roja",isRequired:!0,className:"col-span-4",variant:"underlined",selectionMode:d.red_card>1?"multiple":"single",selectedKeys:y??o,onChange:r=>j(r,a),children:f.map(r=>e.jsx(T,{value:r._id,children:`${r.first_name+" "+r.last_name}`},`${r._id}`))}):(d==null?void 0:d.red_card)>0?e.jsx("div",{className:"flex justify-center w-full mt-3",children:e.jsx(ee,{})}):null}),e.jsx(ye,{placeholder:"Mensaje",className:"pt-5 ",name:"message",defaultValue:c.message,onChange:r=>t(r)}),g?e.jsxs(e.Fragment,{children:[e.jsx(L,{isSelected:P,onValueChange:p,className:"mt-3",isDisabled:h,children:"Mejor Jugador"}),P&&e.jsx(J,{"aria-label":"Best Local Player",placeholder:"Selecciona al mejor jugador",variant:"underlined",name:"best_player",value:b,onChange:F,children:f.map(r=>e.jsx(T,{value:r._id,children:`${r.first_name+" "+r.last_name}`},`${r._id}`))}),e.jsxs("div",{children:[e.jsx(L,{isSelected:N,onValueChange:M,className:"mt-3",isDisabled:v,children:"Juego Limpio"}),N&&e.jsx(J,{"aria-label":"Fair Local Player",placeholder:"Selecciona juego limpio",variant:"underlined",name:"fair_play",value:B,defaultValue:(s==null?void 0:s.fair_play)||void 0,onChange:w,children:f.map(r=>e.jsx(T,{value:r._id,children:`${r.first_name+" "+r.last_name}`},r._id))})]})]}):null]})},Ce=({onClose:a,match:s,targetL:i,targetV:t,targetLocal:c,setTargetLocal:o,targetVisit:d,setTargetVisit:f,defaultRedCardLocal:j,defaultRedCardVisit:y,localPlayers:g,visitPlayers:P,targets:p,bestAndFairPlayerExist:h,setbestAndFairPlayerExist:b})=>{var Z,H;const{setRefresh:F}=se(),[N,M]=n.useState({res_local:s==null?void 0:s.res_local,res_visit:s==null?void 0:s.res_visit}),[v,B]=n.useState(),[w,C]=n.useState(),[S,$]=n.useState(!1),[_,r]=n.useState(!1),[m,E]=n.useState((Z=s==null?void 0:s.best_player)==null?void 0:Z._id),[k,R]=n.useState(!1),[Y,ae]=n.useState(!1),[I,le]=n.useState((H=s==null?void 0:s.fair_play)==null?void 0:H._id),q=x=>{const{name:u,value:l}=x.target;M(l===""?A=>({...A,[u]:u==="res_local"?s.res_local:s.res_visit}):A=>({...A,[u]:Number(l)}))},re=x=>{const{name:u,value:l}=x.target;if(u==="yellow_card"&&l===""&&o({...c,yellow_card:Number(i.yellow_card)}),u==="red_card"){if(l==="")return o({...c,red_card:i.red_cards.length});l==0&&B([])}if(u==="message"){if(l===""){o({...c,message:i.message});return}o({...c,message:l})}else o({...c,[u]:Number(l)})},te=x=>{const{name:u,value:l}=x.target;if(u==="yellow_card"&&l===""){f({...d,yellow_card:Number(t.yellow_card)});return}if(u==="red_card"){if(l==="")return f({...d,red_card:t.red_cards.length});l==0&&C([])}if(u==="message"){if(l===""){f({...d,message:t.message});return}f({...d,message:l})}else f({...d,[u]:Number(l)})},K=(x,u)=>{const l=x.target.value;if(u){B(l.split(","));return}else{C(l.split(","));return}},Q=x=>{const{value:u}=x.target;E(u)},X=x=>{const{name:u,value:l}=x.target;le(l)},ne=async x=>{const u={res_local:N.res_local??s.res_local,res_visit:N.res_visit??s.res_visit,targetLocal:c,targetVisit:d,best_player:m,fair_play:I,targetLocal_id:p.local,targetVisit_id:p.visit,redCards:{localPlayersWithRedCards:v??i.red_cards.map(l=>l._id),visitPlayersWithRedCards:w??t.red_cards.map(l=>l._id)}};if(v&&v.length!==c.red_card||w&&w.length!==d.red_card){W.error("El número de 🟥 no coincide con la cantidad de jugadores");return}W.promise(async()=>{try{if((await fetch(`https://apdcc.com.ar/api/matches/results/${s._id}`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",token:U},body:JSON.stringify(u)})).ok)return F(),"Datos cargados con éxito 😀"}catch(l){return console.log(l),"Algo salio mal 😮‍💨"}finally{x()}},{loading:"Loading...",success:l=>l,error:l=>l.message})},ie=x=>{const u={targetLocal_id:p.local,targetVisit_id:p.visit,redCards:{localPlayersWithRedCards:v||[],visitPlayersWithRedCards:w||[]},targetLocal:c,targetVisit:d};W.promise(async()=>{try{if((await fetch(`https://apdcc.com.ar/api/matches/bothloose/${s._id}`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",token:U},body:JSON.stringify(u)})).ok)return F(),"Partdo actualizado con éxito 😀"}catch(l){return console.log(l),"Algo salio mal 😮‍💨"}finally{x()}},{loading:"Loading...",success:l=>l,error:l=>l.message})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute top-4 right-4 flex gap-4",children:e.jsx(G,{radius:"sm",color:"danger",className:"uppercase font-semibold",onPress:()=>ie(a),children:"ambos pierden"})}),e.jsxs("form",{className:"flex flex-col gap-10",children:[e.jsxs("div",{className:"flex gap-10",children:[e.jsx(V,{isLocal:!0,match:s,handleResults:q,handleTarget:re,target:i,defaultRedCards:j,valueTarget:c,players:g,handleSelectionChange:K,playersWithRedCards:v,bestAndFairPlayerExist:h,bestPlayer:S,setBestPlayer:$,otherBestPlayer:_,best_player:m,handleBestPlayer:Q,fairPlay:k,setFairPlay:R,otherFairPlay:Y,fair_play:I,handleFairPlayer:X}),e.jsx(V,{isLocal:!1,match:s,handleResults:q,handleTarget:te,target:t,defaultRedCards:y,valueTarget:d,players:P,handleSelectionChange:K,playersWithRedCards:w,bestAndFairPlayerExist:h,bestPlayer:_,setBestPlayer:r,otherBestPlayer:S,best_player:m,handleBestPlayer:Q,fairPlay:Y,setFairPlay:ae,otherFairPlay:k,fair_play:I,handleFairPlayer:X})]}),e.jsx(G,{className:"z-0 order-last w-full font-semibold uppercase bg-primary/60 hover:bg-primary",variant:"solid",radius:"sm",startContent:xe,onPress:()=>{ne(a)},children:"Guardar"})]})]})},Se=Ce;function $e({match:a,tournamentId:s,targetL:i,targetV:t}){const{isOpen:c,onOpen:o,onOpenChange:d}=de(),[f,j]=n.useState(!0),[y,g]=n.useState({red_card:i==null?void 0:i.red_cards.length,yellow_card:i==null?void 0:i.yellow_card,message:i==null?void 0:i.message}),[P,p]=n.useState({red_card:t==null?void 0:t.red_cards.length,yellow_card:t==null?void 0:t.yellow_card,message:t==null?void 0:t.message}),[h,b]=n.useState(null),[F,N]=n.useState(),[M,v]=n.useState(),[B,w]=n.useState([]),[C,S]=n.useState([]),$=async(_,r)=>{try{const m=await fetch(`https://apdcc.com.ar/api/players/all/?team=${_}`,{method:"GET",credentials:"include",headers:{token:U}});if(m.ok){const{response:E}=await m.json();r?w(E):S(E)}}catch(m){throw new Error(m)}};return n.useEffect(()=>{var _,r;j(!0),(_=a==null?void 0:a.best_player)!=null&&_._id&&((r=a==null?void 0:a.fair_play)!=null&&r._id)&&j(!1)},[a,d]),n.useEffect(()=>{a&&(async()=>{try{const r=await fetch(`https://apdcc.com.ar/api/targets/tournament/${s}/match/${a._id}`);if(!r.ok){console.log("Algo salio mal en el fetch");return}const{response:m}=await r.json(),E=m.find(R=>R.team_id._id===a.local.team_id._id),k=m.find(R=>R.team_id._id===a.visit.team_id._id);b({local:E._id,visit:k._id})}catch(r){console.error(r)}})()},[s,a._id]),n.useEffect(()=>{$(a.local.team_id._id,!0)},[y]),n.useEffect(()=>{$(a.visit.team_id._id,!1)},[P]),n.useEffect(()=>{const _=i.red_cards.map(m=>m._id);N(_);const r=t.red_cards.map(m=>m._id);v(r)},[]),e.jsxs(e.Fragment,{children:[e.jsx(G,{onPress:o,color:"primary",size:"sm",endContent:e.jsx(je,{size:16}),className:"top-0 right-0 flex font-semibold hover:text-white ms-auto",children:"Editar"}),e.jsx(ce,{isOpen:c,onOpenChange:d,hideCloseButton:!0,size:"4xl",className:"w-full border dark text-foreground border-default-400",children:e.jsx(ue,{children:_=>e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"flex gap-1 items-center justify-between",children:e.jsx("p",{children:"Carga de datos"})}),e.jsx(be,{children:e.jsx(Se,{onClose:_,match:a,targetL:i,targetV:t,targetLocal:y,setTargetLocal:g,targetVisit:P,setTargetVisit:p,defaultRedCardLocal:F,defaultRedCardVisit:M,localPlayers:B,visitPlayers:C,targets:h,bestAndFairPlayerExist:f,setbestAndFairPlayerExist:j})})]})})})]})}function Ke(){const{id:a}=fe(),{isHiddenTopBar:s,refresh:i}=se(),[t,c]=n.useState(),[o,d]=n.useState(null),[f,j]=n.useState(),[y,g]=n.useState();return n.useEffect(()=>{a&&(async p=>{const h=await pe(p);if(h.ok){const{response:b}=await h.json();d(b),c(b.tournament_id)}})(a)},[a,i]),n.useEffect(()=>{async function P(){try{const p=await fetch(`https://apdcc.com.ar/api/targets/tournament/${o.tournament_id._id}/match/${o._id}`);if(p.ok){const{response:h}=await p.json();j(h.filter(b=>b.team_id._id===o.local.team_id._id)[0]),g(h.filter(b=>b.team_id._id===o.visit.team_id._id)[0])}}catch(p){console.log(p)}}o&&P()},[o]),o?e.jsxs("section",{className:`${s?"pt-12":"pt-36"} absolute top-0 left-0 w-full pl-5 lg:pl-[200px] pb-16  lg:pt-20 pr-5 overflow-y-scroll h-screen bg-black`,children:[f&&y?e.jsx($e,{match:o,tournamentId:o.tournament_id._id,targetL:f,targetV:y}):null,e.jsx(ve,{infoHeader:t,match:o}),e.jsx(Ne,{match:o,targetLocal:f,targetVisit:y}),e.jsx(Pe,{match:o,targetLocal:f,targetVisit:y})]}):e.jsx("div",{className:`${s?"pt-12":"pt-36"} absolute top-0 left-0 flex justify-center items-center w-full pl-5 lg:pl-[200px] pb-16  lg:pt-20 pr-5 overflow-y-scroll h-screen bg-black`,children:e.jsx(ee,{})})}export{Ke as default};
